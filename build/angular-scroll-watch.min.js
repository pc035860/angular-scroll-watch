/*! anguar-scroll-watch
version: 0.5.3
build date: 2014-11-25
author: Chih-Hsuan Fan
https://github.com/pc035860/angular-scroll-watch.git */
!function(t){function e(t){var e=0;return angular.forEach(t,function(){e++}),e}function n(t,e){var n=[];t:for(var i=0;i<t.length;i++){for(var s=t[i],r=0;r<e.length;r++)if(s==e[r])continue t;n.push(s)}return n}function i(t){if(angular.isArray(t))return t;if(angular.isString(t))return t.split(" ");if(angular.isObject(t)){var e=[];return angular.forEach(t,function(t,n){t&&(e=e.concat(n.split(" ")))}),e}return t}function s(t,e){if(angular.isArray(t)){e=e||[];for(var n=0;n<t.length;n++)e[n]=t[n]}else if(angular.isObject(t)){e=e||{};for(var i in t)!hasOwnProperty.call(t,i)||"$"===i.charAt(0)&&"$"===i.charAt(1)||(e[i]=t[i])}return e||t}var r="swStyle",o="swClass",a="swBroadcast",l="swStage",c="pc035860",u="scrollWatch.stages";t.factory("scrollWatchStageFactory",["$window","$document","$parse","$log","$rootScope","$animate",function(t,r,o,a,l,c){var u=function(e,n,i){var s;return function(){var r=this,o=arguments;t.clearTimeout(s),s=t.setTimeout(function(){s=null,i||e.apply(r,o)},n),i&&!s&&e.apply(r,o)}},f=function(){return t.requestAnimationFrame||t.webkitRequestAnimationFrame||t.mozRequestAnimationFrame||t.oRequestAnimationFrame||t.msRequestAnimationFrame||function(e){t.setTimeout(e,1e3/60)}}(),g=angular.element(t),h=function(t,e){this.init(t,e)},d=h.prototype;return d.name=null,d.element=null,d.configs=null,d._configId=0,d._binded=!1,d.init=function(t,e){this.name=t,this.element=e||null,this.scrollHandler=this._digest.bind(this),this._digestDebounced=u(this._digest,50),this._digestDebounced()},d.setElement=function(t){this.element=t,null===this.configs||this._binded||this._bind(this.element),this._digestDebounced()},d.clearElement=function(){this._binded&&this._unbind(this.element),this.element=null},d.addConfig=function(t){if(angular.forEach(["target","from","to"],function(e){if(angular.isUndefined(t[e]))throw new Error("`"+e+"` should be provided")}),null===this.configs&&(this.configs={},null!==this.element&&this._bind(this.element)),this._configId++,t.styleExpr&&(t.styleGetter=o(t.styleExpr)),t.classExpr&&(t.classGetter=o(t.classExpr)),t.brdcstExpr){var e=t.scope.$eval(t.brdcstExpr);e.$rootScope?(t.brdcstScope=l,delete e.$rootScope):t.brdcstScope=t.scope,e.$emit?(t.brdcstIsEmit=!0,delete e.$emit):t.brdcstIsEmit=!1,t.brdcstList=[],angular.forEach(e,function(e,n){var i={event:n};angular.isString(e)?(i.condition=o(e),i.wasActive=null):i.always=!0,t.brdcstList.push(i)})}return this.configs[this._configId]=t,this._digestDebounced(),this._configId},d.removeConfig=function(t){this.configs&&this.configs[t]&&(delete this.configs[t],0===e(this.configs)&&(this.configs=null,null!==this.element&&this._unbind(this.element)))},d.digest=function(t){this._digest(null,t)},d.destroy=function(){this._unbind(this.element),this.configs=null,this.element=null,this.scrollHandler=null,this._digestDebounced=null},d.couldDestroy=function(){return null===this.element&&null===this.configs},d._isDefault=function(){return this.element[0]===t},d._getElementMetrics=function(t){var e,n,i,s,r;return s=t[0],e=s.getBoundingClientRect(),i=this._scrollTop(),n={offsetTop:e.top+i},r=this._isDefault()?n.offsetTop:this._traverseStageTop(s),angular.isDefined(r)&&null!==r&&(n.stageTop=r),n},d._traverseStageTop=function(t){var e,n,i=this.element[0],s=0,r=function(t,e){return e||(e={}),e.parentNode=t.offsetParent,e.offsetTop=t.offsetTop,e.hitStage=e.parentNode===i,e},o=0;e=t,n=r(e);do{if(e=e.parentNode||e,n.parentNode===e){if(s+=n.offsetTop,n.hitStage)return s;n=r(e,n)}else if(e===i)return s+n.offsetTop-i.offsetTop;if(++o>=10)break}while("BODY"!==e.tagName||t===e);return null},d._contentHeight=function(){if(this._isDefault()){var t=r[0].documentElement,e=r[0].body;return Math.max(e.scrollHeight,t.scrollHeight,e.offsetHeight,t.offsetHeight,t.clientHeight)}return this.element[0].scrollHeight},d._containerHeight=function(){if(this._isDefault()){var e=r[0].documentElement.clientHeight,n=t.innerHeight;return e>n?n:e}return this.element[0].offsetHeight},d._scrollTop=function(){return this._isDefault()?t.pageYOffset:this.element[0].scrollTop},d._digest=function(){function t(t){var n,i,s,o,a=this._containerHeight(),l=this._contentHeight(),c=l-a,u=this._scrollTop(),f=this;n=function(t){return c+t},i=function(t){return t-c},s=function(t){return t>0?i(t):n(t)},o=function(t){var s,o,a,l;s=t.from<0?n(t.from):t.from,o=t.to<0?n(t.to):t.to,s>u?(l=0,a={$positive:s,$negative:i(s)}):u>o?(l=1,a={$positive:o,$negative:i(o)}):u>=s&&o>=u&&(l=(u-s)/(o-s),a={$positive:u,$negative:i(u)}),a.$progress=l,a.$percentage=100*l,t._lastProgress&&t._lastProgress!==l?t._lastProgress>l?a.$direction=-1:t._lastProgress<l&&(a.$direction=1):a.$direction=0,a.$height=t.target[0].offsetHeight,angular.forEach(f._getElementMetrics(t.target),function(t,e){a["$"+e]=t}),t.styleGetter&&e(a,t),t.classGetter&&r(a,t),t.brdcstList&&g(a,t),t._lastProgress=l},angular.isUndefined(t)?angular.forEach(this.configs,o):this.configs[t]&&o(this.configs[t])}var e,r,o,a,l,u,g,h;return e=function(t,e){e.target.css(e.styleGetter(e.scope,t))},o=function(t,e){var n=t.attr,i=l(t,e,1);n.$addClass(i)},a=function(t,e){var n=t.attr,i=l(t,e,-1);n.$removeClass(i)},l=function(t,e,n){var i=t.target,s=i.data("$classCounts")||{},r=[];return angular.forEach(e,function(t){(n>0||s[t])&&(s[t]=(s[t]||0)+n,s[t]===+(n>0)&&r.push(t))}),i.data("$classCounts",s),r.join(" ")},u=function(t,e,i){var s=t.target,r=n(i,e),o=n(e,i);o=l(t,o,-1),r=l(t,r,1),0===r.length?c.removeClass(s,o):0===o.length?c.addClass(s,r):c.setClass(s,r,o),t.scope.$digest()},r=function(t,e){var n=e.classGetter(e.scope,t),r=e._oldClassVal,a=i(n||[]);if(r){if(!angular.equals(n,r)){var l=i(r);u(e,l,a)}}else o(e,a);e._oldClassVal=s(n)},h=function(t,e){var n=t.$root.$$phase;"$apply"==n||"$digest"==n?e&&"function"==typeof e&&e():t.$apply(e)},g=function(t,e){angular.forEach(e.brdcstList,function(n){var i,s;s=e.brdcstIsEmit?"$emit":"$broadcast",n.always?e.brdcstScope[s](n.event,null,t):n.condition&&(i=n.condition(e.scope,t),(null===n.wasActive||i!==n.wasActive)&&h(e.brdcstScope,function(){e.brdcstScope[s](n.event,i,t)}),n.wasActive=i)})},function(e,n){if(!(null===this.element||this._digesting&&angular.isUndefined(n))){var i=this;this._digesting=!0,f(function(){t.call(i,n),i._digesting=!1})}}}(),d._bind=function(t){this._binded=!0,this._isDefault()?g.on("scroll",this.scrollHandler).on("resize",this.scrollHandler):(g.on("resize",this.scrollHandler),t.on("scroll",this.scrollHandler))},d._unbind=function(t){this._binded=!1,this._isDefault()?g.off("scroll",this.scrollHandler).off("resize",this.scrollHandler):(g.off("resize",this.scrollHandler),t.off("scroll",this.scrollHandler))},function(t,e){return new h(t,e)}}]).service("scrollWatchService",["scrollWatchStageFactory","$window","$log","$cacheFactory",function(t,e,n,i){var s=t(c,angular.element(e));this.stages=i(u),this.stages.put(c,s),this.addStage=function(e,n){var i=this.stages.get(e);return i?void i.setElement(n):(i=t(e,n),void this.stages.put(e,i))},this.removeStage=function(t){var e=this.stages.get(t);e&&(e.clearElement(),this._checkStageDestroy(e))},this.addConfig=function(e){var n=e.stage,i=this.stages.get(n);return i||(i=t(n),this.stages.put(n,i)),[n,i.addConfig(e)]},this.removeConfig=function(t){var e=t[1],n=this._getStage(t);n&&(n.removeConfig(e),this._checkStageDestroy(n))},this.digest=function(t){var e=t[1],n=this._getStage(t);n&&n.digest(e)},this._checkStageDestroy=function(t){t.couldDestroy()&&(t.destroy(),this.stages.remove(t.name))},this._getStage=function(t){var e=t[0];return this.stages.get(e)}}]).directive("scrollWatch",["scrollWatchService","$parse",function(t){return{restrict:"A",link:function(e,n,i){function s(s){s&&angular.isObject(s)&&(s=angular.copy(s),u&&(t.removeConfig(u),(f||angular.noop)()),s.target=n,s.scope=e,s.stage=s.stage||c,i[r]&&(s.styleExpr=i[r]),i[o]&&(s.classExpr=i[o],s.attr=i),i[a]&&(s.brdcstExpr=i[a]),s.digestSync&&(f=e.$watch(l)),u=t.addConfig(s))}function l(){u&&t.digest(u)}var u,f;(i[r]||i[o]||i[a])&&(e.$watch(i.scrollWatch,s,!0),n.on("$destroy",function(){u&&t.removeConfig(u)}))}}}]).directive("swStage",["scrollWatchService",function(t){return{restrict:"A",link:function(e,n,i){var s;i.$observe(l,function(e){e&&(s&&t.removeStage(s),s=e,t.addStage(s,n))}),n.on("$destroy",function(){s&&t.removeStage(s)})}}}])}(angular.module("pc035860.scrollWatch",[]));